<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê°€ë‚˜ë¹„ â€” íˆë¼ê°€ë‚˜Â·ê°€íƒ€ì¹´ë‚˜ ìˆ˜í–‰í‰ê°€</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&family=Noto+Sans+JP:wght@400;700&display=swap');

  :root {
    --bg: #f5f2e8;
    --card: #ffffff;
    --green-light: #c8ddb0;
    --green-dark: #5a8a3c;
    --green-btn: #c8ddb0;
    --green-text: #4a7a32;
    --text: #2d2d2d;
    --text-light: #666;
    --border: #d0c9b0;
    --shadow: 0 2px 12px rgba(0,0,0,0.08);
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Noto Sans KR', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    color: var(--text);
  }

  .screen {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px 20px;
  }
  .screen.active { display: flex; }

  .logo-area { margin-bottom: 28px; text-align: center; }
  .logo-mark {
    display: inline-flex; align-items: center; justify-content: center;
    margin-bottom: 6px;
  }
  .logo-tagline {
    font-size: clamp(1.4rem, 3.5vw, 1.9rem);
    font-weight: 900;
    color: var(--green-dark);
    letter-spacing: -0.5px;
  }
  .logo-area p { color: var(--text-light); font-size: 0.9rem; margin-top: 4px; }

  /* â”€â”€ ì„¤ì • ì¹´ë“œ â”€â”€ */
  .settings-card {
    background: var(--card);
    border-radius: 20px;
    padding: clamp(24px, 5vw, 40px) clamp(20px, 6vw, 48px);
    box-shadow: var(--shadow);
    width: 100%;
    max-width: 580px;
  }

  .section-title {
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--text-light);
    letter-spacing: 1.2px;
    text-transform: uppercase;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid #eee;
  }
  .section-label {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 10px;
  }

  /* ë¼ë””ì˜¤ */
  .radio-group { display: flex; flex-direction: column; gap: 7px; }

  .radio-option {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 10px;
    border: 2px solid #eee;
    cursor: pointer;
    transition: all 0.15s;
    user-select: none;
  }
  .radio-option:hover { border-color: var(--green-light); background: #f6fbf0; }
  .radio-option.selected { border-color: var(--green-dark); background: #eef7e4; }

  .radio-dot {
    width: 18px; height: 18px;
    border-radius: 50%;
    border: 2px solid #ccc;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: all 0.15s;
  }
  .radio-option.selected .radio-dot { border-color: var(--green-dark); background: var(--green-dark); }
  .radio-dot::after {
    content: ''; width: 7px; height: 7px;
    border-radius: 50%; background: white; display: none;
  }
  .radio-option.selected .radio-dot::after { display: block; }

  .radio-text { font-size: 0.88rem; font-weight: 500; color: var(--text); line-height: 1.5; }

  .badge-preview { display: inline-flex; gap: 3px; margin-left: 5px; flex-wrap: wrap; vertical-align: middle; }
  .badge-mini {
    background: var(--green-light); color: var(--green-dark);
    border-radius: 20px; padding: 1px 7px;
    font-size: 0.75rem; font-weight: 700;
  }
  .badge-mini.fixed { background: #ffd6d6; color: #c0392b; }

  /* ìŠ¤í…Œí¼ */
  .stepper-group { display: flex; gap: 10px; flex-wrap: wrap; }

  .stepper-item {
    flex: 1; min-width: 100px;
    background: #f8f7f2;
    border-radius: 12px;
    padding: 12px 10px;
    border: 1px solid var(--border);
    text-align: center;
  }
  .stepper-label {
    font-size: 0.8rem; font-weight: 700;
    margin-bottom: 8px;
    display: flex; align-items: center; justify-content: center; gap: 5px;
  }
  .diff-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
  .diff-dot.sang { background: #e74c3c; }
  .diff-dot.jung { background: #f39c12; }
  .diff-dot.ha   { background: #27ae60; }

  .stepper-controls { display: flex; align-items: center; justify-content: center; gap: 8px; }
  .stepper-btn {
    width: 28px; height: 28px; border-radius: 8px;
    border: 2px solid var(--green-light); background: white;
    color: var(--green-dark); font-size: 1.1rem; font-weight: 900;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: all 0.1s; line-height: 1;
  }
  .stepper-btn:hover { background: var(--green-light); }
  .stepper-btn:active { transform: scale(0.93); }
  .stepper-val { font-size: 1.3rem; font-weight: 900; color: var(--text); min-width: 22px; text-align: center; }

  .total-badge { text-align: center; margin-top: 10px; font-size: 0.82rem; color: var(--text-light); }
  .total-badge span { font-weight: 700; color: var(--green-dark); }

  .divider { border: none; border-top: 1px solid #eee; margin: 22px 0; }

  .btn-primary {
    background: var(--green-btn); color: var(--green-text); border: none;
    border-radius: 10px; padding: 13px 32px;
    font-size: 1rem; font-weight: 700; font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer; transition: background 0.2s, transform 0.1s; width: 100%;
    margin-top: 4px;
  }
  .btn-primary:hover { background: #b0cc98; }
  .btn-primary:active { transform: scale(0.98); }
  .btn-primary:disabled { background: #bbb; cursor: not-allowed; }

  .btn-secondary {
    background: white; color: var(--green-text);
    border: 2px solid var(--green-btn); border-radius: 10px;
    padding: 11px 32px; font-size: 1rem; font-weight: 700;
    font-family: 'Noto Sans KR', sans-serif; cursor: pointer;
    transition: all 0.2s; width: 100%; margin-top: 10px;
  }
  .btn-secondary:hover { background: #f0fae8; }

  /* â”€â”€ ì—…ë¡œë“œ ì¹´ë“œ â”€â”€ */
  .upload-card {
    background: var(--card); border-radius: 20px;
    padding: clamp(24px, 5vw, 40px) clamp(20px, 6vw, 48px);
    box-shadow: var(--shadow); width: 100%; max-width: 520px; text-align: center;
  }
  .upload-card h2 { font-size: 1.1rem; font-weight: 700; margin-bottom: 24px; }

  .excel-format {
    background: #f8f7f2; border-radius: 12px;
    padding: 16px 20px; margin-bottom: 28px;
    text-align: left; border: 1px solid var(--border);
  }
  .excel-format p { font-size: 0.82rem; color: var(--text-light); margin-bottom: 10px; font-weight: 500; }
  .excel-cols { display: flex; gap: 8px; }
  .col-badge { flex: 1; padding: 8px 12px; border-radius: 8px; text-align: center; font-size: 0.85rem; font-weight: 700; }
  .col-badge.sang { background: #ffd6d6; color: #c0392b; }
  .col-badge.jung { background: #fff0c0; color: #b8860b; }
  .col-badge.ha   { background: #d6efd6; color: #2e7d32; }
  .col-badge small { display: block; font-weight: 400; font-size: 0.75rem; margin-top: 2px; }

  .drop-zone {
    border: 2px dashed var(--green-light); border-radius: 14px;
    padding: 36px 20px; cursor: pointer; transition: all 0.2s;
    margin-bottom: 16px; background: #f9fdf5;
  }
  .drop-zone:hover, .drop-zone.dragover { background: #eef8e4; border-color: var(--green-dark); }
  .drop-zone .icon { font-size: 2.4rem; margin-bottom: 10px; }
  .drop-zone p { color: var(--text-light); font-size: 0.9rem; }
  .drop-zone strong { color: var(--green-dark); }
  #file-input { display: none; }

  .file-status { margin-top: 12px; margin-bottom: 4px; font-size: 0.85rem; color: var(--green-dark); font-weight: 500; min-height: 20px; }

  /* â”€â”€ í…ŒìŠ¤íŠ¸ í™”ë©´ â”€â”€ */
  #test-screen {
    display: none;
    padding: 2vh 8vw;
    width: 100%; height: 100vh;
    box-sizing: border-box;
    flex-direction: column;
    max-width: 1100px;
    margin: 0 auto;
  }

  .test-header { text-align: center; margin-bottom: 1.5vh; }
  .test-header h1 {
    font-size: clamp(2rem, 4vw, 3.2rem);
    font-weight: 900; color: var(--text); letter-spacing: -1px;
  }

  .question-block {
    background: var(--card); border-radius: 16px;
    padding: 1.5vh 3vw;
    margin-bottom: 1.2vh; box-shadow: var(--shadow);
    flex: 1; display: flex; flex-direction: column; justify-content: center;
  }
  .question-block.q1-block { flex: 0.9; }

  .q-title-row { display: flex; align-items: center; flex-wrap: wrap; gap: clamp(8px, 1.5vw, 14px); }

  .q-label {
    display: inline-flex; align-items: center; justify-content: center;
    width: clamp(34px, 4vw, 48px); height: clamp(34px, 4vw, 48px);
    min-width: clamp(34px, 4vw, 48px);
    background: #ffffff; border-radius: 8px;
    border: 2px solid var(--green-btn);
    font-weight: 900; font-size: clamp(1rem, 2vw, 1.35rem);
    color: var(--green-text); flex-shrink: 0;
  }

  .q-instruction {
    font-size: clamp(0.95rem, 2vw, 1.5rem); font-weight: 700; color: var(--text);
    line-height: 1.5; display: inline; white-space: normal;
  }

  .row-badge-inline {
    background: var(--green-btn); color: var(--green-text);
    border-radius: 36px;
    min-width: clamp(72px, 10vw, 120px);
    height: clamp(46px, 7vw, 72px);
    display: inline-flex; align-items: center; justify-content: center;
    font-weight: 700; font-size: clamp(1rem, 2.5vw, 1.8rem);
    white-space: nowrap; flex-shrink: 0; overflow: hidden;
    padding: 0 clamp(12px, 2vw, 22px);
    text-align: center; word-break: keep-all; line-height: 1.2;
  }
  .row-badge-inline.long {
    font-size: clamp(0.9rem, 1.8vw, 1.3rem); white-space: normal; line-height: 1.2; word-break: keep-all; padding: 0 clamp(10px, 1.5vw, 18px);
  }

  .word-grid {
    display: grid; grid-template-columns: repeat(5, 1fr);
    gap: 1.2vw; margin-top: 1vh; flex: 1;
  }
  .word-grid.cols-4 { grid-template-columns: repeat(4, 1fr); }
  .word-grid.cols-3 { grid-template-columns: repeat(3, 1fr); }
  .word-grid.cols-2 { grid-template-columns: repeat(2, 1fr); }

  .word-card-wrap { display: flex; flex-direction: column; align-items: center; gap: 4px; height: 100%; }

  .word-num {
    font-size: clamp(1rem, 1.8vw, 1.3rem); color: var(--green-text);
    display: flex; align-items: center; justify-content: center;
    font-weight: 600; flex-shrink: 0;
  }

  .word-card {
    border: 2px solid #b0cc98; border-radius: 14px;
    background: var(--green-btn); display: flex;
    align-items: center; justify-content: center;
    width: 100%; padding: 1.5vh 1vw;
    flex: 1; min-height: 6vh; max-height: 16vh;
  }
  .word-korean {
    font-size: clamp(1.1rem, 2.8vw, 2rem); font-weight: 700;
    color: var(--green-text); line-height: 1.2; text-align: center;
  }

  .btn-row { display: flex; justify-content: center; margin-top: 1.5vh; flex-shrink: 0; }

  .btn-click-here {
    background: var(--green-btn); color: var(--green-text); border: none;
    border-radius: 10px; padding: 1.2vh 6vw;
    font-size: clamp(0.9rem, 1.8vw, 1.1rem); font-weight: 700;
    font-family: 'Noto Sans KR', sans-serif; cursor: pointer;
    transition: background 0.2s, transform 0.1s; letter-spacing: 0.5px;
  }
  .btn-click-here:hover { background: #b0cc98; color: var(--green-text); }
  .btn-click-here:active { transform: scale(0.97); }

  /* â”€â”€ í–‰ ì„ íƒ ë²„íŠ¼ â”€â”€ */
  .row-btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 4px; }
  .row-btn {
    padding: 9px 18px; border-radius: 20px;
    border: 2px solid #d8d8d8;
    background: white; color: var(--text-light);
    font-size: 0.88rem; font-weight: 700;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer; transition: all 0.15s; user-select: none;
  }
  .row-btn:hover { border-color: var(--green-btn); background: #f4f9ef; color: var(--green-text); }
  .row-btn.selected { border-color: var(--green-btn); background: var(--green-btn); color: var(--green-text); }

  @media (max-width: 600px) {
    .word-grid { grid-template-columns: repeat(2, 1fr) !important; }
    .stepper-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }
    .stepper-item { min-width: unset; }
  }

  /* â”€â”€ ë¡œê·¸ì¸ í™”ë©´ â”€â”€ */
  #login-screen {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
    animation: fadeUp 0.4s ease both;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .login-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 48px 40px 44px;
    width: 100%;
    max-width: 480px;
    text-align: center;
    box-shadow: 0 4px 24px rgba(0,0,0,0.07);
  }
  .login-title {
    font-size: 24px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 20px;
    letter-spacing: -0.3px;
  }
  .login-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 20px;
    border-radius: 24px;
    font-size: 13px;
    font-weight: 500;
    margin-bottom: 28px;
  }
  .login-badge.pending { background: #f2f2f2; color: #888; }
  .login-badge.ready  { background: #e8f5e0; color: #4a8a3a; }
  .login-badge.error  { background: #fff3e0; color: #e07a00; }
  .login-badge.checking { background: #e8f0fe; color: #3a6ae0; }
  .login-guide {
    font-size: 13px;
    color: #8a8a8a;
    margin-bottom: 16px;
    line-height: 1.6;
  }
  .login-input {
    width: 100%;
    padding: 16px 20px;
    background: #f8f8f8;
    border: 1.5px solid #e8e8e8;
    border-radius: 12px;
    font-size: 15px;
    font-family: 'Noto Sans KR', sans-serif;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    text-align: center;
    margin-bottom: 14px;
  }
  .login-input::placeholder { color: #b8b8b8; }
  .login-input:focus {
    border-color: var(--green-light);
    background: #fff;
    box-shadow: 0 0 0 3px rgba(168,200,154,0.2);
  }
  .login-btn {
    width: 100%;
    padding: 16px;
    background: var(--green-btn);
    color: var(--green-text);
    border: none;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 700;
    font-family: 'Noto Sans KR', sans-serif;
    cursor: pointer;
    transition: background 0.2s;
    margin-bottom: 16px;
  }
  .login-btn:hover { background: #b0cc98; }
  .login-btn:disabled { background: #d0d0d0; cursor: not-allowed; }
  .login-result {
    font-size: 13px;
    line-height: 1.8;
    display: none;
    margin-bottom: 8px;
  }
  .login-result.error { color: #e05a00; display: block; }
  .login-result.success { color: #3a8a2a; display: block; }
  .login-footer {
    margin-top: 20px;
    font-size: 11px;
    color: #b0b0b0;
    line-height: 1.8;
  }
  .login-footer a { color: var(--green-text); text-decoration: none; font-weight: 500; }
  .login-spinner {
    display: inline-block;
    width: 13px; height: 13px;
    border: 2px solid rgba(50,50,50,0.2);
    border-top-color: var(--green-text);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    margin-right: 6px;
    vertical-align: middle;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* â”€â”€ ë¬¸ì ì„ íƒ í™”ë©´ â”€â”€ */
  #select-screen {
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 40px 20px;
  }
  #select-screen.active {
    display: flex !important;
  }
  .select-card {
    background: var(--card);
    border-radius: 20px;
    padding: 48px 48px 44px;
    width: 100%;
    max-width: 500px;
    text-align: center;
    box-shadow: var(--shadow);
  }
  .select-card h2 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 8px;
    color: var(--text);
  }
  .select-card p {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 36px;
  }
  .select-btn-group {
    display: flex;
    gap: 16px;
    justify-content: center;
    margin-bottom: 12px;
  }
  .select-btn {
    flex: 1;
    padding: 28px 16px;
    border-radius: 16px;
    border: 2px solid var(--border);
    background: white;
    cursor: pointer;
    transition: all 0.15s;
    font-family: 'Noto Sans KR', sans-serif;
  }
  .select-btn:hover {
    border-color: var(--green-btn);
    background: #f4f9ef;
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
  }
  .select-btn .select-kana {
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 2.2rem;
    font-weight: 700;
    color: var(--green-text);
    display: block;
    margin-bottom: 8px;
  }
  .select-btn .select-label {
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--text);
    display: block;
    margin-bottom: 4px;
  }
  .select-btn .select-sub {
    font-size: 0.75rem;
    color: var(--text-light);
    display: block;
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• STEP 1: ì„¤ì • í™”ë©´ â•â•â•â•â•â•â•â•â•â• -->
<!-- â•â•â•â•â•â•â•â•â•â• LOGIN SCREEN â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-card">
    <div style="margin-bottom:18px;">
      <div style="font-size:1.5rem;font-weight:900;color:var(--green-dark);letter-spacing:-0.5px;">ê°€ë‚˜ ìˆ˜í–‰í‰ê°€ ìƒì„±ê¸°</div>
    </div>
    <div class="login-title" style="font-size:1rem;margin-bottom:16px;">ğŸ”&nbsp; ì´ë©”ì¼ ì¸ì¦</div>
    <div class="login-badge pending" id="loginBadge" style="display:none;">ğŸ”’ ì¸ì¦ ì „</div>
    <input type="email" id="loginEmail" class="login-input" placeholder="ë“±ë¡ëœ ì´ë©”ì¼ ì…ë ¥" autocomplete="email" />
    <button class="login-btn" id="loginBtn" onclick="handleLogin()">ì¸ì¦ ë° ì‹œì‘í•˜ê¸°</button>
    <div class="login-result" id="loginResult"></div>
    <div class="login-footer">
      êµ¬ë§¤ í›„ ì´ë©”ì¼ ë“±ë¡ì´ í•„ìš”í•©ë‹ˆë‹¤<br>
      ë¬¸ì˜: <a href="https://sshkor.tistory.com" target="_blank">Hello, EduTech</a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• SELECT SCREEN â•â•â•â•â•â•â•â•â•â• -->
<div id="select-screen" class="screen">
  <div class="logo-area">
    <div class="logo-mark">
      <span class="logo-tagline">ê°€ë‚˜ ìˆ˜í–‰í‰ê°€ ìƒì„±ê¸°</span>
    </div>
    <p>ë¬¸ì ì¢…ë¥˜ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
  </div>
  <div class="select-card">
    <h2>ì–´ë–¤ ë¬¸ìë¡œ í‰ê°€í• ê¹Œìš”?</h2>
    <p>ì„ íƒí•œ ë¬¸ìì— ë§ëŠ” ì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤</p>
    <div class="select-btn-group">
      <button class="select-btn" onclick="selectScript('hiragana')">
        <span class="select-kana">ã‚</span>
        <span class="select-label">íˆë¼ê°€ë‚˜</span>
        <span class="select-sub">ã‚ã„ã†ãˆãŠ</span>
      </button>
      <button class="select-btn" onclick="selectScript('katakana')">
        <span class="select-kana">ã‚¢</span>
        <span class="select-label">ê°€íƒ€ì¹´ë‚˜</span>
        <span class="select-sub">ã‚¢ã‚¤ã‚¦ã‚¨ã‚ª</span>
      </button>
    </div>
  </div>
</div>

<div id="settings-screen" class="screen">
  <div class="logo-area">
    <div class="logo-mark">
      <span class="logo-tagline" id="settings-logo-tagline">íˆë¼ê°€ë‚˜ ìˆ˜í–‰í‰ê°€</span>
    </div>
    <p>ë¬¸í•­ ì„¤ì • í›„ íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</p>
  </div>

  <div class="settings-card">

    <!-- Q1 -->
    <div class="section-title">1ë²ˆ ë¬¸ì œ â€” ì²« ë²ˆì§¸ í–‰ ì„ íƒ</div>
    <div class="section-label" style="margin-bottom:10px;">ì¶œì œí•  í–‰ì„ ì„ íƒí•˜ì„¸ìš”</div>

    <div class="section-label" style="font-size:0.82rem; font-weight:400; color:var(--text-light); margin-bottom:8px;">
      ì„ íƒí•œ í–‰ ì¤‘ ëœë¤ 1ê°œ ì¶œì œ
    </div>
    <div class="row-btn-group" id="q1-row-btns">
      <button class="row-btn" onclick="selectFrontRow(this,'ì•„í–‰')">ì•„í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ì¹´í–‰')">ì¹´í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ì‚¬í–‰')">ì‚¬í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'íƒ€í–‰')">íƒ€í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ë‚˜í–‰')">ë‚˜í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'í•˜í–‰')">í•˜í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ë§ˆí–‰')">ë§ˆí–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ë¼í–‰')">ë¼í–‰</button>
      <button class="row-btn" onclick="selectFrontRow(this,'ì•¼í–‰+ì™€í–‰')">ì•¼í–‰+ì™€í–‰</button>
    </div>

    <div id="q1-warning" style="display:none; margin-top:8px; font-size:0.78rem; color:#e74c3c;">
      âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.
    </div>

    <div style="margin-top:12px; padding:10px 14px; background:#f8f7f2; border-radius:10px; font-size:0.8rem; color:var(--text-light); border:1px solid var(--border); min-height:38px;">
      <strong style="color:var(--green-text);">ë‘ ë²ˆì§¸ í–‰</strong> &nbsp;â†’&nbsp; <span id="second-row-preview">ë‚˜ë¨¸ì§€ í–‰ ì¤‘ ìë™ ëœë¤</span>
    </div>

    <hr class="divider">

    <!-- Q2 -->
    <div class="section-title">2ë²ˆ ë¬¸ì œ â€” ë‚œì´ë„ë³„ ë‹¨ì–´ ìˆ˜</div>
    <div class="stepper-group">
      <div class="stepper-item">
        <div class="stepper-label"><span class="diff-dot sang"></span> ìƒ ë‚œì´ë„</div>
        <div class="stepper-controls">
          <button class="stepper-btn" onclick="changeCount('sang',-1)">âˆ’</button>
          <div class="stepper-val" id="val-sang">1</div>
          <button class="stepper-btn" onclick="changeCount('sang',1)">+</button>
        </div>
      </div>
      <div class="stepper-item">
        <div class="stepper-label"><span class="diff-dot jung"></span> ì¤‘ ë‚œì´ë„</div>
        <div class="stepper-controls">
          <button class="stepper-btn" onclick="changeCount('jung',-1)">âˆ’</button>
          <div class="stepper-val" id="val-jung">2</div>
          <button class="stepper-btn" onclick="changeCount('jung',1)">+</button>
        </div>
      </div>
      <div class="stepper-item">
        <div class="stepper-label"><span class="diff-dot ha"></span> í•˜ ë‚œì´ë„</div>
        <div class="stepper-controls">
          <button class="stepper-btn" onclick="changeCount('ha',-1)">âˆ’</button>
          <div class="stepper-val" id="val-ha">1</div>
          <button class="stepper-btn" onclick="changeCount('ha',1)">+</button>
        </div>
      </div>
    </div>
    <div class="total-badge" id="total-badge">ì´ ë‹¨ì–´ ìˆ˜: <span>4</span>ê°œ</div>

    <hr class="divider">

    <button class="btn-primary" onclick="goToUpload()">ë‹¤ìŒ â†’ íŒŒì¼ ì—…ë¡œë“œ</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• STEP 2: ì—…ë¡œë“œ í™”ë©´ â•â•â•â•â•â•â•â•â•â• -->
<div id="upload-screen" class="screen">
  <div class="logo-area">
    <div class="logo-mark">
      <span class="logo-tagline" id="upload-logo-tagline">íˆë¼ê°€ë‚˜ ìˆ˜í–‰í‰ê°€</span>
    </div>
    <p>ë‹¨ì–´ë¥¼ ì—…ë¡œë“œí•˜ë©´ ë¬¸ì œê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤</p>
  </div>

  <div class="upload-card">
    <h2>ğŸ“‹ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ</h2>

    <div class="excel-format">
      <p>ì—‘ì…€ íŒŒì¼ í˜•ì‹ (Aì—´: ìƒ / Bì—´: ì¤‘ / Cì—´: í•˜)</p>
      <div class="excel-cols">
        <div class="col-badge sang">Aì—´<br><small>ìƒ ë‚œì´ë„</small></div>
        <div class="col-badge jung">Bì—´<br><small>ì¤‘ ë‚œì´ë„</small></div>
        <div class="col-badge ha">Cì—´<br><small>í•˜ ë‚œì´ë„</small></div>
      </div>
    </div>

    <div class="drop-zone" id="drop-zone" onclick="document.getElementById('file-input').click()">
      <div class="icon">ğŸ“‚</div>
      <p><strong>í´ë¦­</strong>í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
      <p style="font-size:0.78rem; margin-top:6px; color:#aaa;">.xlsx / .xls íŒŒì¼</p>
    </div>
    <input type="file" id="file-input" accept=".xlsx,.xls">

    <div id="file-replace-row" style="display:none; text-align:right; margin-top:6px;">
      <button onclick="document.getElementById('file-input').click()"
        style="background:none; border:none; color:var(--green-text); font-size:0.82rem;
               font-weight:600; cursor:pointer; font-family:'Noto Sans KR',sans-serif;
               text-decoration:underline; padding:0;">
        ğŸ“ íŒŒì¼ ë³€ê²½
      </button>
    </div>

    <div class="file-status" id="file-status"></div>

    <button class="btn-primary" id="generate-btn" disabled onclick="generateTest()">
      ë¬¸ì œ ìƒì„±í•˜ê¸°
    </button>
    <button class="btn-secondary" onclick="goToSettings()">â† ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• TEST SCREEN â•â•â•â•â•â•â•â•â•â• -->
<div id="test-screen">
  <div class="test-header">
    <h1 id="test-title">íˆë¼ê°€ë‚˜ ì“°ê¸°</h1>
  </div>

  <div class="question-block q1-block">
    <div class="q-title-row">
      <span class="q-label">1</span>
      <span class="q-instruction" id="q1-instruction">íˆë¼ê°€ë‚˜ <span id="q1-badges-inline"></span> ì— í•´ë‹¹í•˜ëŠ” 10ìë¥¼ ì“°ì‹œì˜¤.</span>
    </div>
  </div>

  <div class="question-block">
    <div class="q-title-row">
      <span class="q-label">2</span>
      <span class="q-instruction" id="q2-instruction">ë‹¤ìŒ ë‹¨ì–´ì— í•´ë‹¹í•˜ëŠ” ì¼ë³¸ì–´ë¥¼ íˆë¼ê°€ë‚˜ë¡œ ì“°ì‹œì˜¤.</span>
    </div>
    <div class="word-grid" id="q2-word-grid"></div>
  </div>

  <div class="btn-row">
    <button class="btn-click-here" onclick="generateTest()">Click Here</button>
  </div>
</div>

<script>

// â”€â”€ ë¬¸ì ì¢…ë¥˜ â”€â”€
let currentScript = 'hiragana'; // 'hiragana' or 'katakana'

const ROWS_MAP = {
  hiragana: ['ì•„í–‰','ì¹´í–‰','ì‚¬í–‰','íƒ€í–‰','ë‚˜í–‰','í•˜í–‰','ë§ˆí–‰','ë¼í–‰','ì•¼í–‰+ì™€í–‰'],
  katakana: ['ì•„í–‰','ì¹´í–‰','ì‚¬í–‰','íƒ€í–‰','ë‚˜í–‰','í•˜í–‰','ë§ˆí–‰','ë¼í–‰','ì•¼í–‰+ì™€í–‰']
};

function selectScript(type) {
  currentScript = type;
  // í–‰ ë²„íŠ¼ ì—…ë°ì´íŠ¸
  const rows = ROWS_MAP[type];
  const btnGroup = document.getElementById('q1-row-btns');
  btnGroup.innerHTML = rows.map(r =>
    `<button class="row-btn" onclick="selectFrontRow(this,'${r}')">${r}</button>`
  ).join('');
  selectedFrontRows = [];
  updateSecondRowPreview();

  // ì œëª© ì—…ë°ì´íŠ¸
  const titleText = type === 'hiragana' ? 'íˆë¼ê°€ë‚˜ ì“°ê¸°' : 'ê°€íƒ€ì¹´ë‚˜ ì“°ê¸°';
  const scriptLabel = type === 'hiragana' ? 'íˆë¼ê°€ë‚˜' : 'ê°€íƒ€ì¹´ë‚˜';
  document.querySelector('.test-header h1') && (document.querySelector('.test-header h1').textContent = titleText);
  document.getElementById('test-title') && (document.getElementById('test-title').textContent = titleText);
  // í™”ë©´ë³„ íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
  ['settings-logo-tagline','upload-logo-tagline'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.textContent = type === 'hiragana' ? 'íˆë¼ê°€ë‚˜ ìˆ˜í–‰í‰ê°€' : 'ê°€íƒ€ì¹´ë‚˜ ìˆ˜í–‰í‰ê°€';
  });
  // q1 ì§€ì‹œë¬¸ ì•ë¶€ë¶„ ì—…ë°ì´íŠ¸ (badges spanì€ ìœ ì§€)
  const q1inst = document.getElementById('q1-instruction');
  q1inst.childNodes[0].textContent = scriptLabel + ' ';
  document.getElementById('q2-instruction').textContent = `ë‹¤ìŒ ë‹¨ì–´ì— í•´ë‹¹í•˜ëŠ” ì¼ë³¸ì–´ë¥¼ ${scriptLabel}ë¡œ ì“°ì‹œì˜¤.`;
  // (ë¸Œëœë“œ ì´ë¦„ì€ í•­ìƒ ê°€ë‚˜ë¹„ë¡œ ê³ ì •)

  showScreen('settings-screen');
}


// â”€â”€ ë¡œê·¸ì¸ â”€â”€
const GAS_URL = 'https://script.google.com/macros/s/AKfycbysVUQ5lvx0Em7E3k1uMyJvOhLXGs9172toKBbHiUe2wEvMF7TaMVypNJahzpicJIfj/exec';

document.getElementById('loginEmail').addEventListener('keydown', e => {
  if (e.key === 'Enter') handleLogin();
});

async function handleLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const btn   = document.getElementById('loginBtn');
  const badge = document.getElementById('loginBadge');
  const result = document.getElementById('loginResult');

  result.className = 'login-result';
  result.textContent = '';

  if (!email) { showLoginResult('ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showLoginResult('ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.'); return; }

  btn.disabled = true;
  btn.innerHTML = '<span class="login-spinner"></span>í™•ì¸ ì¤‘...';
  badge.style.display = '';
  badge.className = 'login-badge checking';
  badge.textContent = 'ğŸ”„ í™•ì¸ ì¤‘...';

  try {
    const res  = await fetch(GAS_URL + '?email=' + encodeURIComponent(email));
    const data = await res.json();

    if (data.success) {
      badge.className = 'login-badge ready';
      badge.textContent = 'âœ… ì¸ì¦ ì™„ë£Œ';
      // ë¡œê·¸ì¸ í™”ë©´ ìˆ¨ê¸°ê³  ì„¤ì • í™”ë©´ìœ¼ë¡œ
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('select-screen').classList.add('active');
    } else {
      badge.className = 'login-badge error';
      badge.textContent = 'âš ï¸ ì¸ì¦ ì‹¤íŒ¨';
      showLoginResult(data.message || 'ë“±ë¡ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.');
      btn.disabled = false;
      btn.textContent = 'ì¸ì¦ ë° ì‹œì‘í•˜ê¸°';
    }
  } catch(err) {
    badge.className = 'login-badge error';
    badge.textContent = 'âš ï¸ ì—°ë™ ì˜¤ë¥˜';
    showLoginResult('ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    btn.disabled = false;
    btn.textContent = 'ì¸ì¦ ë° ì‹œì‘í•˜ê¸°';
  }
}

function showLoginResult(msg) {
  const el = document.getElementById('loginResult');
  el.textContent = msg;
  el.className = 'login-result error';
}

// ì „ì²´ í–‰ ëª©ë¡
const ALL_ROWS = ['ì•„í–‰','ì¹´í–‰','ì‚¬í–‰','íƒ€í–‰','ë‚˜í–‰','í•˜í–‰','ë§ˆí–‰','ë¼í–‰','ì•¼í–‰+ì™€í–‰'];

// ì²« ë²ˆì§¸ í–‰ìœ¼ë¡œ ì„ íƒëœ í–‰ë“¤
let selectedFrontRows = [];  // ê¸°ë³¸ ë¯¸ì„ íƒ

function selectFrontRow(btn, rowName) {
  const isSelected = btn.classList.contains('selected');

  if (isSelected) {
    // ë§ˆì§€ë§‰ 1ê°œëŠ” í•´ì œ ë¶ˆê°€
    if (selectedFrontRows.length === 1) {
      document.getElementById('q1-warning').style.display = 'block';
      setTimeout(() => document.getElementById('q1-warning').style.display = 'none', 2000);
      return;
    }
    btn.classList.remove('selected');
    selectedFrontRows = selectedFrontRows.filter(r => r !== rowName);
  } else {
    btn.classList.add('selected');
    selectedFrontRows.push(rowName);
  }
  updateSecondRowPreview();
}

function updateSecondRowPreview() {
  const currentRows = ROWS_MAP[currentScript] || ALL_ROWS;
  const secondPool = currentRows.filter(r => !selectedFrontRows.includes(r));
  const el = document.getElementById('second-row-preview');
  if (secondPool.length === 0) {
    el.textContent = '(ì—†ìŒ - ëª¨ë“  í–‰ì´ ì²« ë²ˆì§¸ë¡œ ì„ íƒë¨)';
  } else {
    el.textContent = secondPool.join(' Â· ') + ' ì¤‘ ìë™ ëœë¤';
  }
}
const counts = { sang: 1, jung: 2, ha: 1 };
let wordData = { sang: [], jung: [], ha: [] };

// â”€â”€ ìŠ¤í…Œí¼ â”€â”€
function changeCount(key, delta) {
  const total = counts.sang + counts.jung + counts.ha;
  // ì´í•©ì´ 1ì¸ ìƒíƒœì—ì„œ ë§ˆì´ë„ˆìŠ¤ ì‹œë„ ì‹œ ì°¨ë‹¨
  if (delta < 0 && total <= 1) return;
  counts[key] = Math.max(0, Math.min(6, counts[key] + delta));
  document.getElementById('val-' + key).textContent = counts[key];
  const newTotal = counts.sang + counts.jung + counts.ha;
  document.getElementById('total-badge').innerHTML = `ì´ ë‹¨ì–´ ìˆ˜: <span>${newTotal}</span>ê°œ`;
  // ì´í•©ì´ 1ì´ë©´ ëª¨ë“  âˆ’ ë²„íŠ¼ ë¹„í™œì„±í™”
  document.querySelectorAll('.stepper-btn').forEach(btn => {
    if (btn.textContent === 'âˆ’') {
      btn.disabled = newTotal <= 1;
      btn.style.opacity = newTotal <= 1 ? '0.35' : '';
      btn.style.cursor  = newTotal <= 1 ? 'not-allowed' : '';
    }
  });
}

// â”€â”€ í™”ë©´ ì „í™˜ â”€â”€
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('test-screen').style.display = 'none';
  document.getElementById(id).classList.add('active');
}
function goToUpload() {
  if (selectedFrontRows.length === 0) {
    alert('ì²« ë²ˆì§¸ í–‰ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); return;
  }
  if (counts.sang + counts.jung + counts.ha === 0) {
    alert('ë‹¨ì–´ ìˆ˜ë¥¼ 1ê°œ ì´ìƒ ì„¤ì •í•´ì£¼ì„¸ìš”.'); return;
  }
  showScreen('upload-screen');
}
function goToSettings() {
  // ë“œë¡­ì¡´ ì´ˆê¸°í™”
  const dz = document.getElementById('drop-zone');
  dz.style.padding = '';
  const icon = dz.querySelector('.icon');
  if (icon) icon.style.display = '';
  const ps = dz.querySelectorAll('p');
  if (ps[0]) ps[0].innerHTML = '<strong>í´ë¦­</strong>í•˜ê±°ë‚˜ íŒŒì¼ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”';
  document.getElementById('file-replace-row').style.display = 'none';
  document.getElementById('file-status').textContent = '';
  document.getElementById('generate-btn').disabled = true;
  document.getElementById('file-input').value = '';
  wordData = { sang: [], jung: [], ha: [] };
  showScreen('settings-screen');
}

// â”€â”€ íŒŒì¼ ì—…ë¡œë“œ â”€â”€
const dropZone = document.getElementById('drop-zone');
const fileInput = document.getElementById('file-input');
dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault(); dropZone.classList.remove('dragover');
  if (e.dataTransfer.files[0]) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', e => { if (e.target.files[0]) handleFile(e.target.files[0]); });

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = function(ev) {
    const wb = XLSX.read(ev.target.result, { type: 'binary' });
    const ws = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(ws, { header: 1 });
    wordData = { sang: [], jung: [], ha: [] };
    rows.forEach(row => {
      if (row[0]) wordData.sang.push(String(row[0]).trim());
      if (row[1]) wordData.jung.push(String(row[1]).trim());
      if (row[2]) wordData.ha.push(String(row[2]).trim());
    });
    ['sang','jung','ha'].forEach(k => {
      if (wordData[k].length && ['ìƒ','ì¤‘','í•˜','A','B','C','a','b','c'].includes(wordData[k][0]))
        wordData[k].shift();
    });

    const status = document.getElementById('file-status');
    const replaceRow = document.getElementById('file-replace-row');
    const ok = wordData.sang.length >= counts.sang
            && wordData.jung.length >= counts.jung
            && wordData.ha.length  >= counts.ha;
    if (!ok) {
      status.style.color = '#e74c3c';
      status.textContent = `âš ï¸ ì—…ë¡œë“œ: ìƒ ${wordData.sang.length}ê°œ, ì¤‘ ${wordData.jung.length}ê°œ, í•˜ ${wordData.ha.length}ê°œ (ì„¤ì •: ìƒ ${counts.sang}/ì¤‘ ${counts.jung}/í•˜ ${counts.ha}ê°œ í•„ìš”)`;
      document.getElementById('generate-btn').disabled = true;
      replaceRow.style.display = 'block';
    } else {
      status.style.color = 'var(--green-dark)';
      status.textContent = `âœ… ${file.name} â€” ìƒ ${wordData.sang.length}ê°œ, ì¤‘ ${wordData.jung.length}ê°œ, í•˜ ${wordData.ha.length}ê°œ`;
      document.getElementById('generate-btn').disabled = false;
      // ë“œë¡­ì¡´ ì¶•ì†Œ + íŒŒì¼ ë³€ê²½ ë²„íŠ¼ í‘œì‹œ
      const dz = document.getElementById('drop-zone');
      dz.style.padding = '14px 20px';
      dz.querySelector('.icon').style.display = 'none';
      dz.querySelector('p').textContent = 'íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤';
      replaceRow.style.display = 'block';
    }
  };
  reader.readAsBinaryString(file);
}

// â”€â”€ pick â”€â”€
function pick(arr, n) {
  const copy = [...arr], result = [];
  while (result.length < n && copy.length) {
    const i = Math.floor(Math.random() * copy.length);
    result.push(copy.splice(i, 1)[0]);
  }
  return result;
}

// â”€â”€ ë¬¸ì œ ìƒì„± â”€â”€
function generateTest() {
  if (selectedFrontRows.length === 0) {
    alert('ì²« ë²ˆì§¸ í–‰ì„ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.');
    return;
  }
  const currentRows = ROWS_MAP[currentScript];
  const frontPool = selectedFrontRows.map(name => ({name}));
  const frontRow = pick(frontPool, 1)[0];
  const backPool = currentRows.filter(r => !selectedFrontRows.includes(r)).map(name => ({name}));
  const backRow = backPool.length > 0 ? pick(backPool, 1)[0] : {name: 'â€”'};

  document.getElementById('q1-badges-inline').innerHTML =
    `<span class="row-badge-inline ${frontRow.name.length > 2 ? 'long' : ''}">${frontRow.name}</span>
     <span class="row-badge-inline ${backRow.name.length > 2 ? 'long' : ''}">${backRow.name}</span>`;

  // í•˜(ì‰¬ì›€) â†’ ì¤‘ â†’ ìƒ(ì–´ë ¤ì›€) ìˆœì„œë¡œ ë°°ì¹˜, ê° ê·¸ë£¹ ë‚´ì—ì„œëŠ” ëœë¤
  const allWords = [
    ...pick(wordData.ha,   counts.ha),
    ...pick(wordData.jung, counts.jung),
    ...pick(wordData.sang, counts.sang),
  ];

  const nums = ['â‘ ','â‘¡','â‘¢','â‘£','â‘¤','â‘¥','â‘¦','â‘§'];
  const gridEl = document.getElementById('q2-word-grid');
  gridEl.innerHTML = '';
  gridEl.className = 'word-grid';
  const total = allWords.length;
  if (total <= 2) gridEl.classList.add('cols-2');
  else if (total === 3) gridEl.classList.add('cols-3');
  else if (total === 4) gridEl.classList.add('cols-4');

  allWords.forEach((word, idx) => {
    const wrap = document.createElement('div');
    wrap.className = 'word-card-wrap';
    wrap.innerHTML = `
      <div class="word-num">${nums[idx] || (idx+1)}</div>
      <div class="word-card"><div class="word-korean">${word}</div></div>
    `;
    gridEl.appendChild(wrap);
  });

  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('test-screen').style.display = 'flex';
  window.scrollTo(0, 0);
}
</script>
</body>
</html>
